{% extends 'biblioteca/base.html' %}

{% block title %}{{ libro.titulo }} - Detalles{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Navegación -->
    <div class="row mb-4">
        <div class="col-12">
            <a href="{% url 'biblioteca:lista_libros' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Volver al Catálogo
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Columna de la Imagen y Acciones de Préstamo -->
        <div class="col-md-4 mb-4">
            <div style="height: 400px; background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); display: flex; align-items-center; justify-content: center; color: white; border-radius: 12px;" class="shadow-sm">
                <i class="fas fa-book-open" style="font-size: 5rem;"></i>
            </div>
            
            <div class="card mt-4">
                <div class="card-body text-center">
                    {% if libro.cantidad_disponible > 0 %}
                        <span class="badge bg-success mb-3 fs-6">Disponible ({{ libro.cantidad_disponible }} en stock)</span>
                        {% if user.is_authenticated %}
                            <a href="{% url 'biblioteca:solicitar_prestamo' libro.id %}" class="btn btn-success w-100">
                                <i class="fas fa-hand-holding-heart"></i> Solicitar Préstamo
                            </a>
                        {% else %}
                            <a href="{% url 'biblioteca:login' %}?next={{ request.path }}" class="btn btn-primary w-100">Inicia sesión para solicitar</a>
                        {% endif %}
                    {% else %}
                        <span class="badge bg-danger mb-3 fs-6">No disponible</span>
                        <button class="btn btn-secondary w-100" disabled>No se puede solicitar</button>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Columna de Información del Libro -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h1 class="card-title">{{ libro.titulo }}</h1>
                    <h5 class="card-subtitle mb-3 text-muted">
                        por 
                        {% for autor in libro.autores.all %}
                            {{ autor.nombre }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                            Autor desconocido
                        {% endfor %}
                    </h5>

                    <div class="mb-3">
                        {% if libro.categoria %}
                        <span class="badge bg-primary">{{ libro.categoria.nombre }}</span>
                        {% endif %}
                        {% for etiqueta in libro.etiquetas.all %}
                        <span class="badge bg-info text-dark">{{ etiqueta.nombre }}</span>
                        {% endfor %}
                    </div>

                    <p>{{ libro.descripcion }}</p>

                    <table class="table table-striped mt-4">
                        <tbody>
                            <tr>
                                <th scope="row"><i class="fas fa-barcode"></i> ISBN</th>
                                <td>{{ libro.isbn }}</td>
                            </tr>
                            <tr>
                                <th scope="row"><i class="fas fa-building"></i> Editorial</th>
                                <td>{{ libro.editorial|default:"No especificada" }}</td>
                            </tr>
                            <tr>
                                <th scope="row"><i class="far fa-file-alt"></i> Páginas</th>
                                <td>{{ libro.numero_paginas|default:"No especificado" }}</td>
                            </tr>
                            <tr>
                                <th scope="row"><i class="fas fa-language"></i> Idioma</th>
                                <td>{{ libro.idioma }}</td>
                            </tr>
                            <tr>
                                <th scope="row"><i class="far fa-calendar-alt"></i> Publicación</th>
                                <td>{{ libro.fecha_publicacion|date:"Y"|default:"No especificada" }}</td>
                            </tr>
                        </tbody>
                    </table>

                    {% if user.is_authenticated %}
                    <div class="mt-4 border-top pt-3">
                        <h5>Acciones de Administrador</h5>
                        <a href="{% url 'biblioteca:editar_libro' libro.pk %}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <a href="{% url 'biblioteca:eliminar_libro' libro.pk %}" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Eliminar
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
